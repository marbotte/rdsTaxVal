---
title: "rdsTaxVal"
format: 
  gfm:
    df_print: kable
---

```{r setup}
require(knitr)
```


## sourcing the function (development phase)

```{r}

lapply(dir("R"),function(x)source(paste("R",x,sep="/")))

```


## Reading the files 

```{r}
rdsBST<-readRDS("../data_google/4.rdsProyectos/dataRedBSTCol.rds")
rdsTDF<-readRDS("../data_google/4.rdsProyectos/dataTDF.rds")
```

## Creating the oneTable objects


```{r}
taxoBST <- new_taxo_oneTab(rdsBST$taxonomy)
taxoTDF <- new_taxo_oneTab(rdsTDF$taxonomy, "oneTable", taxonRanks_names = c(family="family", genus="genus",species="sp_epithet"), taxonRanks_epithetized = c("sp_epithet"))

taxoBST[arrayInd(which(as.matrix(taxoBST) %in% c("","N/D","NA","N/A")), .dim=dim(taxoBST), useNames = T)] <- NA
taxoTDF[arrayInd(which(as.matrix(taxoTDF) %in% c("","N/D","NA","N/A")), .dim=dim(taxoTDF), useNames = T)] <- NA


```

## Manage spaces in the taxonomy table

```{r}
suggested_spaces_BST<-checkSpace(taxoBST)
kable(suggested_spaces_BST)
taxoBST<-correct(taxoBST,suggested_spaces_BST)
```


```{r}
suggested_spaces_TDF<-checkSpace(taxoTDF)
kable(suggested_spaces_TDF)
taxoTDF<-correct(taxoTDF,suggested_spaces_TDF)
```

## Manage undetermined taxa

```{r}
suggested_undetermined_BST<-checkUndetermited(taxoBST)
kable(head(suggested_undetermined_BST))
taxoBST<-correctUndetermined(taxoBST,suggested_undetermined_BST)
```

```{r}
suggested_undetermined_TDF<-checkUndetermited(taxoTDF)
kable(head(suggested_undetermined_TDF))
taxoTDF<-correctUndetermined(taxoTDF,suggested_undetermined_TDF)
```


## Structural problems
### Are genera always in the same family

```{r}
suggested_unicity_familyBST<-checkUnicityGnInFam(taxoBST)
kable(head(suggested_unicity_familyBST))
#correctUndetermined(taxoBST,suggested_unicity_familyBST)
taxoBST<-correctUnicityGnInFam(taxoBST, suggested_unicity_familyBST)
```

```{r}
suggested_unicity_familyTDF<-checkUnicityGnInFam(taxoTDF)
kable(head(suggested_unicity_familyTDF))
taxoTDF<- correctUnicityGnInFam(taxoTDF,suggested_unicity_familyTDF)
```

### Are taxonomic codes always associated with the same information

